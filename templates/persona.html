<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AppJobs - Persona</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
</head>
<body>
    {% include 'base.html' %}
    <div class="container">
        <h1>Bienvenido Usuario</h1>
        <button class="btn btn-primary" onclick="showCreateHVModal()">Crear Hoja de Vida</button>
        <button class="btn btn-secondary" onclick="buscarVacantes()">Buscar Vacantes</button>
        <button class="btn btn-secondary" onclick="showSugerirVacanteModal()">Sugerir Vacante</button>
        <button class="btn btn-danger" onclick="logout()">Cerrar Sesión</button>
    </div>

    <!-- Modal de Crear Hoja de Vida -->
    {% include 'create_hv_modal.html' %}

    <!-- Incluyendo componentes PopUp -->
    {% include 'components/popups.html' %}

    <!-- Contenedor para mensajes -->
    <div id="messageContainer"></div>

    <!-- Contenedor principal de contenido -->
    <div class="container" id="contenidoPrincipal">
        <!-- Aquí se cargarán dinámicamente las vacantes -->
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
    <script>
        // Función para mostrar el modal de sugerir vacante
        function showSugerirVacanteModal() {
            $('#sugerirVacanteModal').modal('show');
        }

        // Función para buscar todas las vacantes registradas
        function buscarVacantes() {
            $.ajax({
                url: '/vacantes',
                method: 'GET',
                success: function(vacantes) {
                    mostrarVacantes(vacantes);
                },
                error: function(error) {
                    console.error('Error en la solicitud AJAX para buscar vacantes:', error);
                    showMessage('Error al buscar vacantes. Por favor, inténtalo de nuevo más tarde.', 'danger');
                }
            });
        }

        // Función para sugerir vacantes según la profesión del usuario
        function sugerirVacante() {
            var profession = $('#profession').val(); // Obtener la profesión del usuario (ejemplo de cómo obtenerla, ajustar según tu implementación)
            $.ajax({
                url: '/sugerir_vacantes/' + profession,
                method: 'GET',
                success: function(vacantes) {
                    mostrarVacantes(vacantes);
                },
                error: function(error) {
                    console.error('Error en la solicitud AJAX para sugerir vacantes:', error);
                    showMessage('Error al sugerir vacantes. Por favor, inténtalo de nuevo más tarde.', 'danger');
                }
            });
        }

        // Función para mostrar las vacantes en el contenido principal
        function mostrarVacantes(vacantes) {
            var html = '';
            vacantes.forEach(function(vacante) {
                html += '<div class="vacante">';
                html += '<h3>' + vacante.titulo + '</h3>';
                html += '<p>Empresa: ' + vacante.empresa + '</p>';
                html += '<p>Descripción: ' + vacante.descripcion + '</p>';
                html += '</div>';
            });
            $('#contenidoPrincipal').html(html);
        }

        // Función para mostrar mensajes (debe estar ajustada según la implementación con mensaje.html)
        function showMessage(message, type) {
            $.ajax({
                url: '/get_message',
                method: 'POST',
                data: { message: message, type: type },
                success: function(response) {
                    $('#messageContainer').html(response.messageHtml);
                    $('.alert').alert();
                },
                error: function(error) {
                    console.error('Error en la solicitud AJAX para obtener mensaje:', error);
                    $('#messageContainer').html('<div class="alert alert-danger">Error al cargar mensaje. Por favor, inténtalo de nuevo más tarde.</div>');
                }
            });
        }

        // Función para cerrar mensajes
        $(document).on('click', '.alert .close', function() {
            $(this).closest('.alert').alert('close');
        });
    </script>
</body>
</html>
